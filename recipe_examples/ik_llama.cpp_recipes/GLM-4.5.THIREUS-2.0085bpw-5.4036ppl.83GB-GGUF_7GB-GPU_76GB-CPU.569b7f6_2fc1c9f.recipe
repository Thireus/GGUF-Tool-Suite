## Quant mix recipe created using Thireus' GGUF Tool Suite - https://gguf.thireus.com/
# Model name: GLM-4.5
# Link to the original model: https://huggingface.co/zai-org/GLM-4.5

## Model head & embeddings — qbits: 32 8 3 
^output_norm\.weight$=f32
^token_embd\.weight$=iq3_kt
^output\.weight$=q8_0

## Multi-headed attention parameters — qbits: 32 3 
^blk\.([0-9]|[1-8][0-9]|9[0-2])\.attn_q\.weight$=iq3_kt
^blk\.([0-9]|[1-8][0-9]|9[0-2])\.attn_norm\.weight$=f32
^blk\.([0-9]|[1-8][0-9]|9[0-2])\.attn_output\.weight$=iq3_kt
^blk\.([0-9]|[1-8][0-9]|9[0-2])\.attn_k_norm\.weight$=f32
^blk\.([0-9]|[1-8][0-9]|9[0-2])\.attn_v\.weight$=iq3_kt
^blk\.([0-9]|[1-8][0-9]|9[0-2])\.attn_v\.bias$=f32
^blk\.([0-9]|[1-8][0-9]|9[0-2])\.attn_q\.bias$=f32
^blk\.([0-9]|[1-8][0-9]|9[0-2])\.attn_q_norm\.weight$=f32
^blk\.([0-9]|[1-8][0-9]|9[0-2])\.attn_k\.bias$=f32
^blk\.([0-9]|[1-8][0-9]|9[0-2])\.attn_k\.weight$=iq3_kt

## Dense Feed-Forward Network weights — qbits: 5 3 
^blk\.[0-2]\.ffn_gate\.weight$=iq3_kt
^blk\.[0-2]\.ffn_up\.weight$=iq3_kt
^blk\.[0-1]\.ffn_down\.weight$=iq3_kt
^blk\.2\.ffn_down\.weight$=iq5_k_r4

## NextN tensors — qbits: 32 3 
^blk\.92\.nextn\.enorm\.weight$=f32
^blk\.92\.nextn\.shared_head_head\.weight$=iq3_kt
^blk\.92\.nextn\.embed_tokens\.weight$=iq3_kt
^blk\.92\.nextn\.shared_head_norm\.weight$=f32
^blk\.92\.nextn\.eh_proj\.weight$=iq3_kt
^blk\.92\.nextn\.hnorm\.weight$=f32

## MoE Gating & Routing — qbits: 32 
^blk\.([3-9]|[1-8][0-9]|9[0-2])\.ffn_gate_inp\.weight$=f32
^blk\.([3-9]|[1-8][0-9]|9[0-2])\.exp_probs_b\.bias$=f32

## Misc / Other tensors — qbits: 32 
^blk\.([0-9]|[1-8][0-9]|9[0-2])\.post_attention_norm\.weight$=f32

## GPU-loaded - MoE Shared Experts Feed-Forward Network - ffn_*_shexp
# ffn_down_shexp — down-projection (shared experts) — qbits: 5 3 
^blk\.(2[8-9]|30|32|91)\.ffn_down_shexp\.weight$=iq5_k_r4
^blk\.([3-9]|1[0-9]|2[0-7]|31|3[3-9]|[4-8][0-9]|90|92)\.ffn_down_shexp\.weight$=iq3_kt

# ffn_up_shexp — up-projection (shared experts) — qbits: 5 3 
^blk\.(31|35|3[8-9]|91)\.ffn_up_shexp\.weight$=iq5_k_r4
^blk\.([3-9]|[1-2][0-9]|30|3[2-4]|3[6-7]|[4-8][0-9]|90|92)\.ffn_up_shexp\.weight$=iq3_kt

# ffn_gate_shexp — gating network (shared experts) — qbits: 5 3 
^blk\.(30|36|46|86|9[0-1])\.ffn_gate_shexp\.weight$=iq5_k_r4
^blk\.([3-9]|[1-2][0-9]|3[1-5]|[3-4][7-9]|4[0-5]|[5-7][0-9]|8[0-5]|8[7-9]|92)\.ffn_gate_shexp\.weight$=iq3_kt

## CPU-friendly - MoE Per-expert Feed-Forward Network - ffn_*_exps
# ffn_down_exps — down-projection (per-expert) — qbits: 3 2 1 
^blk\.([3-4]|11|18|3[0-1]|35)\.ffn_down_exps\.weight$=iq3_kt
^blk\.([5-6]|8|1[4-5]|22|25|4[3-9]|5[1-7]|6[0-1]|64|68|71|78|92)\.ffn_down_exps\.weight$=iq2_kt
^blk\.(7|9|10|1[2-3]|1[6-7]|19|2[0-1]|2[3-4]|[2-3][6-9]|3[2-4]|4[0-2]|50|5[8-9]|6[2-3]|6[5-7]|69|70|7[2-7]|79|8[0-9]|9[0-1])\.ffn_down_exps\.weight$=iq1_kt

# ffn_up_exps — up-projection (per-expert) — qbits: 3 2 1 
^blk\.(24|28)\.ffn_up_exps\.weight$=iq3_kt
^blk\.(11|13|1[5-6]|19|20|23|34|36|44|47|5[0-1]|54|5[6-9]|68|7[0-1]|92)\.ffn_up_exps\.weight$=iq2_kt
^blk\.([3-9]|10|12|14|1[7-8]|2[1-2]|2[5-7]|29|[3-4][0-3]|35|3[7-9]|4[5-6]|4[8-9]|5[2-3]|55|6[0-7]|69|7[2-9]|8[0-9]|9[0-1])\.ffn_up_exps\.weight$=iq1_kt

# ffn_gate_exps — gating network (per-expert) — qbits: 3 2 1 
^blk\.(11|17|19|20|2[2-3]|28|3[0-1]|92)\.ffn_gate_exps\.weight$=iq3_kt
^blk\.(10|12|1[4-5]|21|41|53|64)\.ffn_gate_exps\.weight$=iq2_kt
^blk\.([3-9]|13|16|18|2[4-7]|29|[3-4][2-9]|40|5[0-2]|5[4-9]|6[0-3]|6[5-9]|[7-8][0-9]|9[0-1])\.ffn_gate_exps\.weight$=iq1_kt

## Summary of tensor sizes per class
# GPU Total: 7.56 GiB (89.3%) | 8.47 GiB max, if all were iq5_k_r4 | 7.51 GiB min, if all were iq3_kt
# CPU Total: 76.23 GiB (61.8%) | 123.30 GiB max, if all were iq3_kt | 69.53 GiB min, if all were iq1_kt
# GPU+CPU Total: 83.79 GiB (75.6%)

## Summary of tensor counts and bpw per qtype
#
# GPU-loaded quants:
# QTYPE		Count	BPW	Assigned GiB	% Assigned	Max GiB (all)
# +f32       	835	32    	  0.28 GiB	-		-
# +q8_0      	1  	8.5   	  0.77 GiB	-		-
# iq5_k_r4  	17 	5.5   	  0.12 GiB	5.4%		2.22
# iq4_kt    	0  	4     	  0.00 GiB	0.0%		1.61
# +iq3_kt    	375	3.125 	  5.20 GiB	-		-
# iq3_kt    	263	3.125 	  1.19 GiB	94.6%		1.26
#
# CPU-friendly quants:
# QTYPE		Count	BPW	Assigned GiB	% Assigned	Max GiB (all)
# +iq3_kt    	1  	3.125 	  0.46 GiB	-		-
# iq3_kt    	18 	3.125 	  8.24 GiB	6.7%		122.22
# +iq2_kt    	2  	2.125 	  0.62 GiB	-		-
# iq2_kt    	56 	2.125 	 17.43 GiB	21.0%		83.11
# iq1_kt    	193	1.75  	 49.48 GiB	72.3%		68.44
#
# -Average BPW: 2.0085
#
# -Notes:
# - '+' means user-defined pre-assigned tensors, or tensor missing from csv data or f32 tensors
# - Recipe produced on the 2025-11-21 09:42:09 GMT+0000 using Thireus' GGUF tools (https://gguf.thireus.com/)
# - Script SHA-256: 569b7f6a3239c9173d71ca1fadf34222607d72a2cfed2c284b42633e95b4a627
# - Calibration dataset 'ppl_results.csv' SHA-256: eee3f314cf1ecaa746932341b2189f8a7718e62489bbd250f957c4aec82c0015
# - tensors.bf16.map SHA-256: 4e8b7b435f6257174a7adfc90290ac92c36758fef201ba0f5358338eea7606b8
# - tensors.bf16.map model name: GLM-4.5-THIREUS-BF16-SPECIAL_TENSOR-01762-of-01762
# - tensors.q8_0.map SHA-256: 2814e1547cf288d327264135ed3f83e612b879826640283037d45f95a22ebfe2
# - tensors.q8_0.map model name: GLM-4.5-THIREUS-Q8_0-SPECIAL_TENSOR-01762-of-01762
# - tensors.iq5_k_r4.map SHA-256: c13be13e7b38a6206c03c5c77d5fda27e281b38fff35a1cbe26c024d8cc98741
# - tensors.iq5_k_r4.map model name: GLM-4.5-THIREUS-IQ5_K_R4-SPECIAL_TENSOR-01762-of-01762
# - tensors.iq4_kt.map SHA-256: 19448602b9da7236aead74dac88a1bceaacb40e4a01ef6d6fdd491412f6f3035
# - tensors.iq4_kt.map model name: GLM-4.5-THIREUS-IQ4_KT-SPECIAL_TENSOR-01762-of-01762
# - tensors.iq3_kt.map SHA-256: 6db35592713504d0ba2831f8639658bfcedded822d7b0f869ea5a38c86d299f3
# - tensors.iq3_kt.map model name: GLM-4.5-THIREUS-IQ3_KT-SPECIAL_TENSOR-01762-of-01762
# - tensors.iq2_ks.map SHA-256: 4ed9fc5a73d854ad30f9f75577a1d826150cb23283a0bb54dba45d6aba6c9de2
# - tensors.iq2_ks.map model name: GLM-4.5-THIREUS-IQ2_KS-SPECIAL_TENSOR-01762-of-01762
# - tensors.iq2_kt.map SHA-256: 7f17a966ff370632ec639c844f65a564309a007e1ed2c117c4c5a41e62e26ad4
# - tensors.iq2_kt.map model name: GLM-4.5-THIREUS-IQ2_KT-SPECIAL_TENSOR-01762-of-01762
# - tensors.iq1_kt.map SHA-256: d376bb126ffe99d3c86287926a8c43e9a3b3af7600772a3e832e98b4b46569fc
# - tensors.iq1_kt.map model name: GLM-4.5-THIREUS-IQ1_KT-SPECIAL_TENSOR-01762-of-01762
# - GPG signatures: PASSED
# - Command used:
# ../../quant_assign.py ppl_results.csv --tolerance 0.01 --cpu-irq-k 1.5 --gpu-irq-k 1.5 --gpu-assign-qtype iq3_kt \
# --cpu-tensors-max-size 76 --gpu-tensors-max-size 85% --exponential-factor 8 --cpu-tensors \
# 'blk\.([3-9]|[1-8][0-9]|9[0-1])\.ffn_down_exps\.weight' 'blk\.([3-9]|[1-8][0-9]|9[0-1])\.ffn_up_exps\.weight' \
# 'blk\.([3-9]|[1-8][0-9]|9[0-1])\.ffn_gate_exps\.weight' --gpu-tensors '.*' --cpu-quants iq2_kt iq1_kt iq3_kt \
# --gpu-quants iq4_kt iq5_k_r4 iq3_kt --cpu-assign-tensors 'blk\.(92)\.ffn_down_exps\.weight=iq2_kt' \
# 'blk\.(92)\.ffn_up_exps\.weight=iq2_kt' 'blk\.(92)\.ffn_gate_exps\.weight=iq3_kt' --gpu-assign-tensors \
# 'output\.weight=q8_0' --harmonize-tensors '' --harmonization-technique 0

## THE END!
